
.. _connection_benchmark:

============
并发连接测试
============

该测试场景只测试客户端跟服务器端的MQTT协议连接，该测试场景下除了发送MQTT协议的控制包外，不发送任何用户数据相关的包，测试目的是为了得到*EMQ*在不同并发连接下的表现。

-------
TCP连接
-------

总体结果：EMQ2.0在建立100万以内TCP连接的时候，响应时间都在15ms以内，成功率为100%。内存的使用基本呈线性增长，CPU在用户连接建立的时候表现平稳，没有大幅度的抖动。但是观察到在连接断开的场景下，会发生CPU使用率突然增加到100%的情况。

.. NOTE:: 测试机配置：1台虚拟机支持50000 VU (2个docker*25000 VU)

30万
----

+==================+=======================+===================+============+==============+==============+==============+========+
| 虚拟用户数量(VU) | 每秒新增并发链接(CPS) | 总计运行时间(Sec) | 平均吞吐量 | 平均响应时间 | 最大响应时间 | 最小响应时间 | 成功率 |
+==================+=======================+===================+============+==============+==============+==============+========+
|    300000        |        1000           |         600       |     912    |     9ms      |     7.02s    |    1ms       | 100%   | 
+------------------+-----------------------+-------------------+------------+--------------+--------------+--------------+--------+

30万用户并发测试报告: https://www.xmeter.net/commercialPage.html?page=testrunMonitor&testRunId=895167331


50万
----

500000  1000    900 966 14ms    7.04s   1ms 100%    

CPU shortterm Load最大达到3.88  CPU使用率在7%-65%之间   Memory使用随着并发用户量增加而缓慢增加，最大到7.05G

50万用户并发测试报告: https://www.xmeter.net/commercialPage.html?page=testrunMonitor&testRunId=1231188268

1000K
------

1000000 1000    1200    961 7ms 10.01s  1ms 100%

CPU shortterm Load最大达到6 CPU使用率在6%-80%之间   Memory使用随着并发用户量增加而缓慢增加，最大到13.4G

100万用户并发测试报告: https://www.xmeter.net/commercialPage.html?page=testrunMonitor&testRunId=2084906193
